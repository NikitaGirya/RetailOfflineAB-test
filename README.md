# Эффективность нового мерчандайзинга / Оффлайн A/B-тест

`pandas`  `numpy`  `scipy` `matplotlib`  `seaborn` `greenplum`


<p align="center">
  <img src="https://oborot.ru/wp-content/uploads/2022/03/lerua-merlen-1-1024x681.jpg" width=800 height=500 />
</p>

---

<h2> Постановка задачи </h2>

В магазине A (назовем его тестовый), провели некое изменение, к примеру, мерчандайзинга товаров (расставили по цветам, разнесли на разные стеллажи и т.д.). Задача — оценить влияние данного изменения на чековые метрики продаж и товарооборот

---

<h2> Общий принцип анализа </h2>
<p>
<b> 
Проведение оффлайн A/B-теста</b> – берем тестовый магазин, ищем пять аналогичных по динамике интересующей метрики магазинов за год до внедрения новой имплантации – контрольных магазинов. Сравниваем метрику тестового магазина и пяти контрольных магазинов за период времени (два месяца и более) после внедрения новой имплантации

Проверяем статзначимость разницы метрики между тестовым магазином и каждым из контрольных, а также значимость между средней разницей контрольных. Если критерий показал значимое отличие разницы от нуля, то принимаем гипотезу об изменении метрики (в положительную или отрицательную сторону)

Проведя подобный анализ по всем магазинам с новой имплантацией, сможем понять, повлияла ли она статзначимо на метрики 
  
<hr>
<h3> Детальнее</h3>
<p> <ol>
    <li>Выгрузка из GreenPlum оффлайн продаж (без возвратов и услуг) за год (52 недели) до изменения и до актуальной даты по каждому магазину и интересующему подотделу (типу) с расчетом среднего за неделю среднего чека, штук товара в чеке, уникальных артикулов в чеке, а также привлекательности подотдела в отделе (типа в подотделе)
Из выгрузки исключены все ЦИЗы, дарксторы, закрывшиеся и несуществующие магазины</li>
    <li><b>Тестовыми</b> будут магазины с изменениями в имплантации, произошедшими более двух месяцев назад (агрегация берется понедельно, поэтому менее 8 значений (8 недель, 2 месяца) мало для расчета статистического критерия)
<b>контрольными</b> будут все магазины, где изменение не произошло, а также магазины, где изменение произошло совсем недавно (менее трех недель назад)</li>
    <li><b>Нормализуем</b> интересующую <b>метрику</b> за весь период (52 недели до изменения – контрольный и период после него – тестовый) на среднее значение метрики по 52 неделям контрольного периода. Так постараемся привести магазины к единой шкале, чтобы учесть только динамику интересующей метрики</li>
    <li>Для того, чтобы найти контрольные магазины к тестовому <b>сопоставляем периоды</b> (контрольный и тестовый с количество недель в них должно быть одинаково для каждой пары магазинов, чтобы корректно рассчитать ошибку) и <b>считаем RMSE</b> (корень из среднеквадратической ошибки) между распределениями метрики тестового и контрольных магазинов в контрольном периоде, затем выбираем топ-5 по минимальному значению RMSE магазинов</li>
    <li><b>Считаем разность между значениями метрики</b> тестового магазина и каждого из пяти контрольных магазинов, также суммируем все разности для расчета общей разности теста и контроля</li>
    <li><b>Определяем</b> одновыборочным двусторонним t-критерием <b>статзначимость</b> отличия среднего разницы теста и контроля от нуля. Статзначимость считаем не между самими распределениями метрик (т.к. форма распределения сильно отлична от нормального), а между разницами распределения (она в большинстве своём распределена нормально). Можно использовать непараметрический U-критерий, но это в другой раз
Таким образом <b>нулевая гипотеза H0</b> : среднее значение разницы метрики тестового и контрольного магазина в контрольном периоде равна нулю, <b>альтернативная гипотеза H1</b> : среднее значение разницы метрики тестового и контрольного магазина в контрольном периоде НЕ равна нулю. Также аналогично проверяем гипотезы об отличии среднего значения средней разницы метрики контрольных магазинов от нуля</li>
    <li>На выходе получаем <b>таблицу со значениями</b>:
    <ul>
        <li>Тип магазина (тест или контроль)</li>
        <li>Название магазина</li>
        <li>RMSE между тестовым и контрольным магазином в контрольном периоде</li>
        <li>p-value одновыборочного двустороннего t-критерия (гипотеза о равенстве среднего значения разницы между тестом и контролем нулю для контрольного периода)</li>
        <li>среднее значение метрики по неделям тестового периода для каждого магазина</li>
        <li>относительное изменение метрики между тестовым и контрольными магазинами в тестовом периоде (в %)</li>
        <li>абсолютное изменение метрики между тестовым и контрольными магазинами в тестовом периоде (в ед. измерения метрики)</li>
        <li>p-value одновыборочного двустороннего t-критерия (гипотеза о равенстве среднего значения разницы между тестом и контролем нулю для тестового периода)</li>
       <li>Вердикт по итогу расчета статкритерия: 'yes' - опровергли нулевую гипотезу (то, что нам нужно, чтобы доказать наличие статзначимого изменения), 'no' - приняли нулевую гипотезу (статзначимого изменения нет)
           </li>
</ol>
</p>
</div>
